{"remainingRequest":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\chook\\chook-cls.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\chook\\chook-cls.vue","mtime":1562898218000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {get, post} from \"../../libs/axios-cfg\";\nimport UploadImg from \"../main/components/upload-img/upload-img\";\n\nexport default {\n    name: \"chook-cls\",\n    components: {UploadImg},\n    data() {\n        return {\n            img: {\n                visible: false,\n                url: ''\n            },\n            options: {\n                status: [\n                    {value: \"Y\", label: \"生效\"},\n                    {value: \"N\", label: \"失效\"}\n                ],\n                market: []\n            },\n            search: {\n                status: 'Y',\n                marketId: null,\n                page: 1,\n                pageSize: 10\n            },\n            content: {\n                total: 0,\n                loading: false,\n                records: [],\n                columns: [\n                    {\n                        title: '柚子鸡ID',\n                        key: 'id',\n                        width: 100\n                    }, {\n                        title: '柚子鸡名称',\n                        key: 'name',\n                        width: 100\n                    }, {\n                        title: '归属集市',\n                        key: 'marketId',\n                        width: 100,\n                        render: (h, params) => {\n                            let marketName = this.marketMap[params.row.marketId];\n                            return h('span', {}, marketName);\n                        }\n                    }, {\n                        title: '图片',\n                        key: 'icon',\n                        width: 130,\n                        render: (h, params) => {\n                            if (params.row.icon) {\n                                let imgUrl = this.baseImgUrl + params.row.icon;\n                                return h('img', {\n                                    attrs: {\n                                        src: imgUrl,\n                                    },\n                                    style: {\n                                        width: '80px',\n                                        height: '80px'\n                                    },\n                                    on: {\n                                        click: (e) => {\n                                            this.handleBigImg(e.srcElement.currentSrc)\n                                        }\n                                    }\n                                }, '类别icon');\n                            } else {\n                                return h('Icon', {\n                                    attrs: {\n                                        size: 80,\n                                        type: \"ios-image-outline\"\n                                    }\n                                });\n                            }\n                        }\n                    }, {\n                        title: '价值范围',\n                        key: 'valueRange',\n                        width: 150,\n                        render: (h, params) => {\n                            let valueRange = params.row.minValue + \" - \" + params.row.maxValue;\n                            return h('span', {}, valueRange);\n                        }\n                    }, {\n                        title: '领养时间',\n                        key: 'adoptTime',\n                        width: 180,\n                        render: (h, params) => {\n                            let adoptTime = params.row.startTime + \" - \" + params.row.endTime;\n                            return h('span', {}, adoptTime);\n                        }\n                    }, {\n                        title: '领养周期(天)',\n                        key: 'cycle',\n                        width: 120,\n                        render: (h, params) => {\n                            return h('span', {}, params.row.cycle + \"天\")\n                        }\n                    }, {\n                        title: '周期收益率(%)',\n                        key: 'changeRatio',\n                        width: 120,\n                        render: (h, params) => {\n                            return h('span', {}, params.row.changeRatio * 100 + \"%\");\n                        }\n                    }, {\n                        title: '预约小米',\n                        key: 'subValue',\n                        width: 100\n                    }, {\n                        title: '即抢领养小米',\n                        key: 'robValue',\n                        width: 120\n                    }, {\n                        title: '智能合约收益',\n                        key: 'ecAward',\n                        width: 120\n                    }, {\n                        title: '操作',\n                        key: 'action',\n                        width: 150,\n                        fixed: 'right',\n                        align: 'center',\n                        render: (h, params) => {\n                            return h('div', [\n                                h('Button', {\n                                    props: {\n                                        type: 'primary',\n                                        size: 'small'\n                                    },\n                                    style: {\n                                        marginRight: '5px'\n                                    },\n                                    on: {\n                                        click: () => {\n                                            this.handleRemove(params.row)\n                                        }\n                                    }\n                                }, '删除'),\n                                h('Button', {\n                                    props: {\n                                        type: 'warning',\n                                        size: 'small'\n                                    },\n                                    style: {\n                                        marginRight: '5px'\n                                    },\n                                    on: {\n                                        click: () => {\n                                            this.handleEdit(params.row)\n                                        }\n                                    }\n                                }, '编辑'),\n                            ])\n                        }\n                    }\n                ]\n            },\n            form: {\n                title: \"新增柚子鸡\",\n                show: false,\n                isAdd: true,\n                chookCls: {\n                    timeRange: []\n                },\n                ruleValidate: {\n                    marketId: [\n                        {required: true, message: '请选择集市', trigger: 'blur', type: 'number'}\n                    ],\n                    name: [\n                        {required: true, message: '请输入柚子鸡名称', trigger: 'blur'}\n                    ],\n                    minValue: [\n                        {required: true, message: '请输入最小价值', trigger: 'blur', type: 'number'}\n                    ],\n                    maxValue: [\n                        {required: true, message: '请输入最大价值', trigger: 'blur', type: 'number'}\n                    ],\n                    icon: [\n                        {required: true, message: '请上传鸡图片', trigger: 'blur'}\n                    ],\n                    timeRange: [\n                        {required: true, message: '请选择领养时间范围', trigger: 'blur', type: 'array'}\n                    ],\n                    subValue: [\n                        {required: true, message: '请输入预约消耗小米', trigger: 'blur', type: 'number'}\n                    ],\n                    robValue: [\n                        {required: true, message: '请输入即抢领消耗小米', trigger: 'blur', type: 'number'}\n                    ],\n                    cycle: [\n                        {required: true, message: '请输入领养周期', trigger: 'blur', type: 'number'}\n                    ],\n                    changeRatio: [\n                        {required: true, message: '请输入领养周期收益率', trigger: 'blur', type: 'number'}\n                    ],\n                    ecAward: [\n                        {required: true, message: '请输入交易成功奖励EC币个数', trigger: 'blur', type: 'number'}\n                    ]\n                }\n            }\n        }\n    },\n    created() {\n        this.queryAllMarket();\n        this.queryChookCls();\n    },\n    computed: {\n        marketMap() {\n            let res = {};\n            this.options.market.forEach(e => {\n                res[e.id] = e.name;\n            });\n            return res;\n        }\n    },\n    methods: {\n        handleBigImg(url) {\n            this.img.url = url;\n            this.img.visible = true;\n        },\n        handleSearch() {\n            this.queryChookCls();\n        },\n        handleCreate() {\n            this.form.title = \"新增柚子鸡\";\n            this.form.show = true;\n            this.form.isAdd = true;\n            this.form.chookCls = {}\n        },\n        handleChangePage(page) {\n            this.search.page = page;\n        },\n        handleChangePageSize(pageSize) {\n            this.search.pageSize = pageSize;\n        },\n        handleRemove(row) {\n            this.$Modal.confirm({\n                title: '确认删除',\n                content: '<p>确认删除柚子鸡?</p>',\n                onOk: () => {\n                    this.deleteChookCls(row.id);\n                },\n                onCancel: () => {\n                    this.$Message.info('取消删除操作');\n                }\n            });\n        },\n        handleEdit(row) {\n            this.form.title = \"更新柚子鸡\";\n            this.form.show = true;\n            this.form.isAdd = false;\n            this.form.chookCls = JSON.parse(JSON.stringify(row));\n            this.form.chookCls.changeRatio = this.form.chookCls.changeRatio * 100;\n            let timeRange = [null, null];\n            timeRange[0] = row.startTime;\n            timeRange[1] = row.endTime;\n            this.form.chookCls['timeRange'] = timeRange;\n        },\n        handleSubmit(name) {\n            var self = this;\n            this.$refs[name].validate((valid) => {\n                if (valid) {\n                    if (self.form.isAdd) {\n                        this.createChookCls();\n                    } else {\n                        this.updateChookCls();\n                    }\n                    this.form.show = false;\n                    setTimeout(this.queryChookCls, 1000);\n                } else {\n                    this.$Message.error('验证不通过!')\n                }\n            })\n        },\n        handleReset(name) {\n            this.$refs[name].resetFields()\n        },\n        handleChangeIcon(icon) {\n            this.form.chookCls.icon = icon;\n        },\n        async queryAllMarket() {\n            try {\n                let res = await get(\"api/pomelomgm/market/list/all\");\n                if (res.status == 1) {\n                    this.options.market = res.data;\n                } else {\n                    this.options.market = [];\n                }\n            } catch (e) {\n                this.$throw(e);\n            }\n        },\n        async queryChookCls() {\n            this.content.loading = true;\n            try {\n                let res = await post(\"api/pomelomgm/chook/cls/list\", this.search);\n                if (res.status == this.rescode.OK) {\n                    this.content.total = res.data.total;\n                    this.content.records = res.data.records;\n                } else {\n                    this.$Message.error(res.msg);\n                }\n            } catch (e) {\n                this.$throw(e);\n            }\n            this.content.loading = false;\n        },\n        async deleteChookCls(id) {\n            try {\n                let res = await post(\"api/pomelomgm/chook/cls/remove/\" + id);\n                if (res.status == this.rescode.OK) {\n                    this.$Message.success(\"删除成功\");\n                    this.queryChookCls();\n                } else {\n                    this.$Message.error(res.msg);\n                }\n            } catch (e) {\n                this.$throw(e);\n            }\n        },\n        async createChookCls() {\n            this.form.chookCls.startTime = this.form.chookCls.timeRange[0];\n            this.form.chookCls.endTime = this.form.chookCls.timeRange[1];\n            let body = JSON.parse(JSON.stringify(this.form.chookCls));\n            body.changeRatio = this.form.chookCls.changeRatio / 100;\n            try {\n                let res = await post(\"api/pomelomgm/chook/cls/add\", body);\n                if (res.status == this.rescode.OK) {\n                    this.$Message.success(\"新增柚子鸡成功\");\n                } else {\n                    this.$Message.error(res.msg);\n                }\n            } catch (e) {\n                this.$throw(e);\n            }\n        },\n        async updateChookCls() {\n            this.form.chookCls.startTime = this.form.chookCls.timeRange[0];\n            this.form.chookCls.endTime = this.form.chookCls.timeRange[1];\n            this.form.chookCls.status = this.form.chookCls.status.value;\n            let body = JSON.parse(JSON.stringify(this.form.chookCls));\n            body.changeRatio = this.form.chookCls.changeRatio / 100;\n            try {\n                let res = await post(\"api/pomelomgm/chook/cls/update/\" + this.form.chookCls.id, body);\n                if (res.status == this.rescode.OK) {\n                    this.$Message.success(\"更新柚子鸡成功\");\n                } else {\n                    this.$Message.error(res.msg);\n                }\n            } catch (e) {\n                this.$throw(e);\n            }\n        }\n    }\n}\n",{"version":3,"sources":["chook-cls.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0GA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"chook-cls.vue","sourceRoot":"src/view/chook","sourcesContent":["<template>\r\n    <div>\r\n        <Card>\r\n            <!-- 条件查询 -->\r\n            <div class=\"margin-bottom-10\">\r\n                <Row>\r\n                    <Col span=\"6\">\r\n                        <label>状态: &nbsp;&nbsp;</label>\r\n                        <Select v-model=\"search.status\" placeholder=\"请选择状态\" style=\"width: 150px\">\r\n                            <Option v-for=\"status in options.status\" :value=\"status.value\" :key=\"status.value\">\r\n                                {{status.label }}\r\n                            </Option>\r\n                        </Select>\r\n                    </Col>\r\n                    <Col span=\"6\">\r\n                        <label>集市: &nbsp;&nbsp;</label>\r\n                        <Select v-model=\"search.marketId\" style=\"width:200px\" placeholder=\"请选择集市\" clearable>\r\n                            <Option v-for=\"maket in options.market\" :value=\"maket.id\" :key=\"maket.id\">{{ maket.name }}\r\n                            </Option>\r\n                        </Select>\r\n                    </Col>\r\n                    <Col span=\"6\">\r\n                        <Button type=\"success\" icon=\"ios-search\" @click=\"handleSearch\">查询</Button>\r\n                        <Button type=\"info\" icon=\"md-add\" @click=\"handleCreate\">新增</Button>\r\n                    </Col>\r\n                </Row>\r\n            </div>\r\n\r\n            <!-- 数据展示 -->\r\n            <div class=\"chook-cls-list\" style=\"overflow: hidden\">\r\n                <Table border :loading=\"content.loading\" :columns=\"content.columns\" :data=\"content.records\"></Table>\r\n                <div class=\"margin-top-8\"></div>\r\n                <Page :total=\"content.total\" @on-change=\"handleChangePage\" @on-page-size-change=\"handleChangePageSize\"\r\n                      show-sizer show-total show-elevator class=\"margin-right-10\"\r\n                      style=\"display: inline-flex;float: right;\"/>\r\n            </div>\r\n\r\n            <!-- 新增修改 -->\r\n            <Drawer class=\"add-update-drawer\"\r\n                    :title=\"form.title\"\r\n                    v-model=\"form.show\"\r\n                    width=\"720\"\r\n                    :mask-closable=\"false\">\r\n                <Form :model=\"form.chookCls\" ref=\"formChookCls\" :rules=\"form.ruleValidate\" style=\"margin-right: 30px\">\r\n                    <FormItem label=\"集市: \" label-position=\"left\" :label-width=\"100\" prop=\"marketId\">\r\n                        <Select v-model=\"form.chookCls.marketId\" style=\"width:300px\" placeholder=\"请选择集市\" clearable>\r\n                            <Option v-for=\"maket in options.market\" :value=\"maket.id\" :key=\"maket.id\">{{ maket.name }}\r\n                            </Option>\r\n                        </Select>\r\n                    </FormItem>\r\n                    <FormItem label=\"鸡名称: \" label-position=\"left\" :label-width=\"100\" prop=\"name\">\r\n                        <Input v-model=\"form.chookCls.name\" placeholder=\"请输入柚子鸡名称\" style=\"width: 300px\"/>\r\n                    </FormItem>\r\n                    <FormItem label=\"最小价值: \" label-position=\"left\" :label-width=\"100\" prop=\"minValue\">\r\n                        <Input v-model.number=\"form.chookCls.minValue\" placeholder=\"请输入最小价值\" style=\"width: 300px\"/>\r\n                    </FormItem>\r\n                    <FormItem label=\"最大价值: \" label-position=\"left\" :label-width=\"100\" prop=\"maxValue\">\r\n                        <Input v-model.number=\"form.chookCls.maxValue\" placeholder=\"请输入最大价值\" style=\"width: 300px\"/>\r\n                    </FormItem>\r\n                    <FormItem label=\"鸡图片: \" label-position=\"left\" :label-width=\"100\" prop=\"icon\">\r\n                        <UploadImg :src=\"form.chookCls.icon\" @changeSrc=\"handleChangeIcon\"/>\r\n                    </FormItem>\r\n                    <FormItem label=\"领养时间: \" label-position=\"left\" :label-width=\"100\" prop=\"timeRange\">\r\n                        <TimePicker v-model=\"form.chookCls.timeRange\" format=\"HH:mm:ss\" type=\"timerange\"\r\n                                    placement=\"bottom-end\" placeholder=\"选择领养时间\"\r\n                                    style=\"width: 300px\"></TimePicker>\r\n                    </FormItem>\r\n                    <FormItem label=\"预约消耗小米: \" label-position=\"left\" :label-width=\"100\" prop=\"subValue\">\r\n                        <Input v-model.number=\"form.chookCls.subValue\" placeholder=\"请输入预约消耗小米\" style=\"width: 300px\"/>\r\n                    </FormItem>\r\n                    <FormItem label=\"即抢领消耗小米: \" label-position=\"left\" :label-width=\"100\" prop=\"robValue\">\r\n                        <Input v-model.number=\"form.chookCls.robValue\" placeholder=\"请输入即抢领消耗小米\" style=\"width: 300px\"/>\r\n                    </FormItem>\r\n                    <FormItem label=\"领养周期: \" label-position=\"left\" :label-width=\"100\" prop=\"cycle\">\r\n                        <Input v-model.number=\"form.chookCls.cycle\" placeholder=\"请输入领养周期\" style=\"width: 300px\">\r\n                            <span slot=\"append\">天</span>\r\n                        </Input>\r\n                    </FormItem>\r\n                    <FormItem label=\"周期收益率: \" label-position=\"left\" :label-width=\"100\" prop=\"changeRatio\">\r\n                        <Input v-model.number=\"form.chookCls.changeRatio\" placeholder=\"请输入领养周期收益率%\"\r\n                               style=\"width: 300px\">\r\n                            <span slot=\"append\">%</span>\r\n                        </Input>\r\n                    </FormItem>\r\n                    <FormItem label=\"交易奖励EC币: \" label-position=\"left\" :label-width=\"110\" prop=\"ecAward\">\r\n                        <Input v-model.number=\"form.chookCls.ecAward\" placeholder=\"请输入交易成功奖励EC币个数\"\r\n                               style=\"width: 290px\"/>\r\n                    </FormItem>\r\n                    <FormItem :label-width=\"80\">\r\n                        <Button type=\"primary\" style=\"margin-left: 30px\" @click=\"handleSubmit('formChookCls')\">提交\r\n                        </Button>\r\n                        <Button style=\"margin-left: 8px\" @click=\"handleReset('formChookCls')\">重置</Button>\r\n                    </FormItem>\r\n                </Form>\r\n            </Drawer>\r\n\r\n            <!-- 大图查看 -->\r\n            <Modal title=\"查看大图\" v-model=\"img.visible\" class-name=\"fl-image-modal\">\r\n                <img :src=\"img.url\" v-if=\"img.visible\" style=\"width: 100%\">\r\n            </Modal>\r\n\r\n        </Card>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import {get, post} from \"../../libs/axios-cfg\";\r\n    import UploadImg from \"../main/components/upload-img/upload-img\";\r\n\r\n    export default {\r\n        name: \"chook-cls\",\r\n        components: {UploadImg},\r\n        data() {\r\n            return {\r\n                img: {\r\n                    visible: false,\r\n                    url: ''\r\n                },\r\n                options: {\r\n                    status: [\r\n                        {value: \"Y\", label: \"生效\"},\r\n                        {value: \"N\", label: \"失效\"}\r\n                    ],\r\n                    market: []\r\n                },\r\n                search: {\r\n                    status: 'Y',\r\n                    marketId: null,\r\n                    page: 1,\r\n                    pageSize: 10\r\n                },\r\n                content: {\r\n                    total: 0,\r\n                    loading: false,\r\n                    records: [],\r\n                    columns: [\r\n                        {\r\n                            title: '柚子鸡ID',\r\n                            key: 'id',\r\n                            width: 100\r\n                        }, {\r\n                            title: '柚子鸡名称',\r\n                            key: 'name',\r\n                            width: 100\r\n                        }, {\r\n                            title: '归属集市',\r\n                            key: 'marketId',\r\n                            width: 100,\r\n                            render: (h, params) => {\r\n                                let marketName = this.marketMap[params.row.marketId];\r\n                                return h('span', {}, marketName);\r\n                            }\r\n                        }, {\r\n                            title: '图片',\r\n                            key: 'icon',\r\n                            width: 130,\r\n                            render: (h, params) => {\r\n                                if (params.row.icon) {\r\n                                    let imgUrl = this.baseImgUrl + params.row.icon;\r\n                                    return h('img', {\r\n                                        attrs: {\r\n                                            src: imgUrl,\r\n                                        },\r\n                                        style: {\r\n                                            width: '80px',\r\n                                            height: '80px'\r\n                                        },\r\n                                        on: {\r\n                                            click: (e) => {\r\n                                                this.handleBigImg(e.srcElement.currentSrc)\r\n                                            }\r\n                                        }\r\n                                    }, '类别icon');\r\n                                } else {\r\n                                    return h('Icon', {\r\n                                        attrs: {\r\n                                            size: 80,\r\n                                            type: \"ios-image-outline\"\r\n                                        }\r\n                                    });\r\n                                }\r\n                            }\r\n                        }, {\r\n                            title: '价值范围',\r\n                            key: 'valueRange',\r\n                            width: 150,\r\n                            render: (h, params) => {\r\n                                let valueRange = params.row.minValue + \" - \" + params.row.maxValue;\r\n                                return h('span', {}, valueRange);\r\n                            }\r\n                        }, {\r\n                            title: '领养时间',\r\n                            key: 'adoptTime',\r\n                            width: 180,\r\n                            render: (h, params) => {\r\n                                let adoptTime = params.row.startTime + \" - \" + params.row.endTime;\r\n                                return h('span', {}, adoptTime);\r\n                            }\r\n                        }, {\r\n                            title: '领养周期(天)',\r\n                            key: 'cycle',\r\n                            width: 120,\r\n                            render: (h, params) => {\r\n                                return h('span', {}, params.row.cycle + \"天\")\r\n                            }\r\n                        }, {\r\n                            title: '周期收益率(%)',\r\n                            key: 'changeRatio',\r\n                            width: 120,\r\n                            render: (h, params) => {\r\n                                return h('span', {}, params.row.changeRatio * 100 + \"%\");\r\n                            }\r\n                        }, {\r\n                            title: '预约小米',\r\n                            key: 'subValue',\r\n                            width: 100\r\n                        }, {\r\n                            title: '即抢领养小米',\r\n                            key: 'robValue',\r\n                            width: 120\r\n                        }, {\r\n                            title: '智能合约收益',\r\n                            key: 'ecAward',\r\n                            width: 120\r\n                        }, {\r\n                            title: '操作',\r\n                            key: 'action',\r\n                            width: 150,\r\n                            fixed: 'right',\r\n                            align: 'center',\r\n                            render: (h, params) => {\r\n                                return h('div', [\r\n                                    h('Button', {\r\n                                        props: {\r\n                                            type: 'primary',\r\n                                            size: 'small'\r\n                                        },\r\n                                        style: {\r\n                                            marginRight: '5px'\r\n                                        },\r\n                                        on: {\r\n                                            click: () => {\r\n                                                this.handleRemove(params.row)\r\n                                            }\r\n                                        }\r\n                                    }, '删除'),\r\n                                    h('Button', {\r\n                                        props: {\r\n                                            type: 'warning',\r\n                                            size: 'small'\r\n                                        },\r\n                                        style: {\r\n                                            marginRight: '5px'\r\n                                        },\r\n                                        on: {\r\n                                            click: () => {\r\n                                                this.handleEdit(params.row)\r\n                                            }\r\n                                        }\r\n                                    }, '编辑'),\r\n                                ])\r\n                            }\r\n                        }\r\n                    ]\r\n                },\r\n                form: {\r\n                    title: \"新增柚子鸡\",\r\n                    show: false,\r\n                    isAdd: true,\r\n                    chookCls: {\r\n                        timeRange: []\r\n                    },\r\n                    ruleValidate: {\r\n                        marketId: [\r\n                            {required: true, message: '请选择集市', trigger: 'blur', type: 'number'}\r\n                        ],\r\n                        name: [\r\n                            {required: true, message: '请输入柚子鸡名称', trigger: 'blur'}\r\n                        ],\r\n                        minValue: [\r\n                            {required: true, message: '请输入最小价值', trigger: 'blur', type: 'number'}\r\n                        ],\r\n                        maxValue: [\r\n                            {required: true, message: '请输入最大价值', trigger: 'blur', type: 'number'}\r\n                        ],\r\n                        icon: [\r\n                            {required: true, message: '请上传鸡图片', trigger: 'blur'}\r\n                        ],\r\n                        timeRange: [\r\n                            {required: true, message: '请选择领养时间范围', trigger: 'blur', type: 'array'}\r\n                        ],\r\n                        subValue: [\r\n                            {required: true, message: '请输入预约消耗小米', trigger: 'blur', type: 'number'}\r\n                        ],\r\n                        robValue: [\r\n                            {required: true, message: '请输入即抢领消耗小米', trigger: 'blur', type: 'number'}\r\n                        ],\r\n                        cycle: [\r\n                            {required: true, message: '请输入领养周期', trigger: 'blur', type: 'number'}\r\n                        ],\r\n                        changeRatio: [\r\n                            {required: true, message: '请输入领养周期收益率', trigger: 'blur', type: 'number'}\r\n                        ],\r\n                        ecAward: [\r\n                            {required: true, message: '请输入交易成功奖励EC币个数', trigger: 'blur', type: 'number'}\r\n                        ]\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        created() {\r\n            this.queryAllMarket();\r\n            this.queryChookCls();\r\n        },\r\n        computed: {\r\n            marketMap() {\r\n                let res = {};\r\n                this.options.market.forEach(e => {\r\n                    res[e.id] = e.name;\r\n                });\r\n                return res;\r\n            }\r\n        },\r\n        methods: {\r\n            handleBigImg(url) {\r\n                this.img.url = url;\r\n                this.img.visible = true;\r\n            },\r\n            handleSearch() {\r\n                this.queryChookCls();\r\n            },\r\n            handleCreate() {\r\n                this.form.title = \"新增柚子鸡\";\r\n                this.form.show = true;\r\n                this.form.isAdd = true;\r\n                this.form.chookCls = {}\r\n            },\r\n            handleChangePage(page) {\r\n                this.search.page = page;\r\n            },\r\n            handleChangePageSize(pageSize) {\r\n                this.search.pageSize = pageSize;\r\n            },\r\n            handleRemove(row) {\r\n                this.$Modal.confirm({\r\n                    title: '确认删除',\r\n                    content: '<p>确认删除柚子鸡?</p>',\r\n                    onOk: () => {\r\n                        this.deleteChookCls(row.id);\r\n                    },\r\n                    onCancel: () => {\r\n                        this.$Message.info('取消删除操作');\r\n                    }\r\n                });\r\n            },\r\n            handleEdit(row) {\r\n                this.form.title = \"更新柚子鸡\";\r\n                this.form.show = true;\r\n                this.form.isAdd = false;\r\n                this.form.chookCls = JSON.parse(JSON.stringify(row));\r\n                this.form.chookCls.changeRatio = this.form.chookCls.changeRatio * 100;\r\n                let timeRange = [null, null];\r\n                timeRange[0] = row.startTime;\r\n                timeRange[1] = row.endTime;\r\n                this.form.chookCls['timeRange'] = timeRange;\r\n            },\r\n            handleSubmit(name) {\r\n                var self = this;\r\n                this.$refs[name].validate((valid) => {\r\n                    if (valid) {\r\n                        if (self.form.isAdd) {\r\n                            this.createChookCls();\r\n                        } else {\r\n                            this.updateChookCls();\r\n                        }\r\n                        this.form.show = false;\r\n                        setTimeout(this.queryChookCls, 1000);\r\n                    } else {\r\n                        this.$Message.error('验证不通过!')\r\n                    }\r\n                })\r\n            },\r\n            handleReset(name) {\r\n                this.$refs[name].resetFields()\r\n            },\r\n            handleChangeIcon(icon) {\r\n                this.form.chookCls.icon = icon;\r\n            },\r\n            async queryAllMarket() {\r\n                try {\r\n                    let res = await get(\"api/pomelomgm/market/list/all\");\r\n                    if (res.status == 1) {\r\n                        this.options.market = res.data;\r\n                    } else {\r\n                        this.options.market = [];\r\n                    }\r\n                } catch (e) {\r\n                    this.$throw(e);\r\n                }\r\n            },\r\n            async queryChookCls() {\r\n                this.content.loading = true;\r\n                try {\r\n                    let res = await post(\"api/pomelomgm/chook/cls/list\", this.search);\r\n                    if (res.status == this.rescode.OK) {\r\n                        this.content.total = res.data.total;\r\n                        this.content.records = res.data.records;\r\n                    } else {\r\n                        this.$Message.error(res.msg);\r\n                    }\r\n                } catch (e) {\r\n                    this.$throw(e);\r\n                }\r\n                this.content.loading = false;\r\n            },\r\n            async deleteChookCls(id) {\r\n                try {\r\n                    let res = await post(\"api/pomelomgm/chook/cls/remove/\" + id);\r\n                    if (res.status == this.rescode.OK) {\r\n                        this.$Message.success(\"删除成功\");\r\n                        this.queryChookCls();\r\n                    } else {\r\n                        this.$Message.error(res.msg);\r\n                    }\r\n                } catch (e) {\r\n                    this.$throw(e);\r\n                }\r\n            },\r\n            async createChookCls() {\r\n                this.form.chookCls.startTime = this.form.chookCls.timeRange[0];\r\n                this.form.chookCls.endTime = this.form.chookCls.timeRange[1];\r\n                let body = JSON.parse(JSON.stringify(this.form.chookCls));\r\n                body.changeRatio = this.form.chookCls.changeRatio / 100;\r\n                try {\r\n                    let res = await post(\"api/pomelomgm/chook/cls/add\", body);\r\n                    if (res.status == this.rescode.OK) {\r\n                        this.$Message.success(\"新增柚子鸡成功\");\r\n                    } else {\r\n                        this.$Message.error(res.msg);\r\n                    }\r\n                } catch (e) {\r\n                    this.$throw(e);\r\n                }\r\n            },\r\n            async updateChookCls() {\r\n                this.form.chookCls.startTime = this.form.chookCls.timeRange[0];\r\n                this.form.chookCls.endTime = this.form.chookCls.timeRange[1];\r\n                this.form.chookCls.status = this.form.chookCls.status.value;\r\n                let body = JSON.parse(JSON.stringify(this.form.chookCls));\r\n                body.changeRatio = this.form.chookCls.changeRatio / 100;\r\n                try {\r\n                    let res = await post(\"api/pomelomgm/chook/cls/update/\" + this.form.chookCls.id, body);\r\n                    if (res.status == this.rescode.OK) {\r\n                        this.$Message.success(\"更新柚子鸡成功\");\r\n                    } else {\r\n                        this.$Message.error(res.msg);\r\n                    }\r\n                } catch (e) {\r\n                    this.$throw(e);\r\n                }\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    .chook-cls {\r\n\r\n    }\r\n</style>\r\n"]}]}