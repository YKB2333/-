{"remainingRequest":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\system\\log\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\system\\log\\index.vue","mtime":1562898218000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport dayjs from 'dayjs'\r\nimport { post } from '@/libs/axios-cfg'\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      selections: [],\r\n      removeModal: false,\r\n      setting: {\r\n        loading: true,\r\n        showBorder: true\r\n      },\r\n      columns: [\r\n        {\r\n          type: 'selection',\r\n          width: 60,\r\n          align: 'center'\r\n        },\r\n        { title: '用户ID', key: 'uid' },\r\n        { title: '用户名', key: 'username' },\r\n        { title: '动作名称', key: 'actionName' },\r\n        {\r\n          title: 'IP', key: 'ip', render: (h, params) => {\r\n            let ip = params.row.ip\r\n            let ipSplit = ip.split('.')\r\n            if (ipSplit.length == 4) {\r\n              return h('span', ipSplit[0] + '.' + '***' + '.' + ipSplit[2] + '.' + ipSplit[3])\r\n            }\r\n            return h('span', ip)\r\n          }\r\n        },\r\n        {\r\n          title: '请求类型', key: 'ajax', render: (h, params) => {\r\n            return h('span', params.row.ajax == 0 ? '普通请求' : 'AJAX请求')\r\n          }\r\n        },\r\n        { title: '请求地址', key: 'uri' },\r\n        { title: '请求参数', key: 'params' },\r\n        { title: '请求方法', key: 'httpMethod' },\r\n        { title: '类.方法', key: 'classMethod' },\r\n        {\r\n          title: '创建日期',\r\n          key: 'createDate',\r\n          render: (h, params) => {\r\n            return h('span', dayjs(params.row.createDate).format('YYYY年MM月DD日 HH:mm:ss'))\r\n          },\r\n          sortable: true\r\n        },\r\n        {\r\n          title: '操作',\r\n          key: 'action',\r\n          align: 'center',\r\n          render: (h, params) => {\r\n            return h('div', [\r\n              h('Button', {\r\n                props: { type: 'error', size: 'small' },\r\n                style: { marginRight: '5px' },\r\n                on: {\r\n                  click: () => {\r\n                    this.removeList(params.row.id)\r\n                  }\r\n                }\r\n              }, '删除')\r\n            ])\r\n          }\r\n        }\r\n      ],\r\n      data: {},\r\n      dataFilter: {\r\n        page: 1,\r\n        pageSize: 10\r\n      },\r\n      removeObject: null\r\n    }\r\n  },\r\n  created () {\r\n    this.getData()\r\n  },\r\n  methods: {\r\n    /**\r\n     * @description 批量选择回调\r\n     */\r\n    selectionChange (list) {\r\n      this.selections = list\r\n    },\r\n    /**\r\n     * @description 分页更换事件回调\r\n     */\r\n    pageChange (p) {\r\n      this.dataFilter.page = p\r\n      this.getData()\r\n    },\r\n    /**\r\n     * @description 分页每页显示数量改变事件回调\r\n     */\r\n    pageSizeChange (p) {\r\n      this.dataFilter.pageSize = p\r\n      this.getData()\r\n    },\r\n    /**\r\n     * @description 获取用户列表\r\n     */\r\n    async getData () {\r\n      this.setting.loading = true\r\n      try {\r\n        let res = await post('/system/log/list', {\r\n          page: this.dataFilter.page,\r\n          pageSize: this.dataFilter.pageSize\r\n        })\r\n        this.data = res.data\r\n      } catch (error) {\r\n        this.$throw(error)\r\n      }\r\n      this.setting.loading = false\r\n    },\r\n    /**\r\n     * @description 批量删除\r\n     */\r\n    async removeList (single = false) {\r\n      this.setting.loading = true\r\n      this.$Message.loading({\r\n        content: '日志删除中...',\r\n        duration: 0\r\n      })\r\n      let objs = []\r\n      if (single) {\r\n        objs.push(single)\r\n      } else {\r\n        this.selections.forEach(el => {\r\n          objs.push(el.id)\r\n        })\r\n      }\r\n      try {\r\n        let res = await post('/system/log/remove', objs)\r\n        this.getData()\r\n        this.selections = []\r\n        this.$Message.destroy()\r\n        this.$Message.success({\r\n          content: '日志删除成功',\r\n          duration: 1.5\r\n        })\r\n      } catch (error) {\r\n        this.$throw(error)\r\n      }\r\n      this.setting.loading = false\r\n    },\r\n    /**\r\n     * @description 导出表格CSV\r\n     */\r\n    exportData (type) {\r\n      if (type === 1) {\r\n        this.$refs.table.exportCsv({\r\n          filename: '日志数据-' + new Date().getTime(),\r\n          columns: this.columns.filter((col, index) => index > 0 && index < this.columns.length - 1),\r\n          data: this.data.records\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/view/system/log","sourcesContent":["<template>\r\n  <div>\r\n    <Card>\r\n      <p slot=\"title\" class=\"card-title\">\r\n        <Icon type=\"home\"></Icon>\r\n        <span>日志管理</span>\r\n      </p>\r\n      <div>\r\n        <template>\r\n          <Row>\r\n            <Col span=\"15\" class=\"margin-bottom-10\">\r\n              <Button :disabled=\"setting.loading\" type=\"success\" @click=\"getData\">\r\n                <Icon type=\"md-refresh\"></Icon>&nbsp;刷新数据\r\n              </Button>\r\n              <Button :disabled=\"selections.length==0 || setting.loading\" type=\"error\" @click=\"removeList(false)\">\r\n                <Icon type=\"trash-a\"></Icon>&nbsp;批量删除所选\r\n              </Button>\r\n              <Button type=\"primary\" @click=\"exportData(1)\">\r\n                <Icon type=\"ios-download-outline\"></Icon>&nbsp;导出表格\r\n              </Button>\r\n            </Col>\r\n          </Row>\r\n          <Table ref=\"table\" class=\"margin-bottom-10\" @on-selection-change=\"selectionChange\"\r\n                 :columns=\"columns\" :loading=\"setting.loading\" :border=\"setting.showBorder\"\r\n                 :data=\"data.records\"></Table>\r\n          <Page :total=\"data.total\" class=\"tr\" @on-change=\"pageChange\" :current.sync=\"data.current\"\r\n                :page-size=\"data.size\"\r\n                @on-page-size-change=\"pageSizeChange\" show-elevator show-sizer></Page>\r\n        </template>\r\n      </div>\r\n    </Card>\r\n    <Modal v-model=\"removeModal\" width=\"360\">\r\n      <p slot=\"header\" style=\"color:#f60;text-align:center\">\r\n        <Icon type=\"information-circled\"></Icon>\r\n        <span>提示</span>\r\n      </p>\r\n      <div style=\"text-align:center\">\r\n        <p>此操作为不可逆操作，是否确认删除？</p>\r\n      </div>\r\n      <div slot=\"footer\">\r\n        <Button type=\"error\" size=\"large\" long :loading=\"setting.loading\">确认删除</Button>\r\n      </div>\r\n    </Modal>\r\n  </div>\r\n</template>\r\n<script>\r\nimport dayjs from 'dayjs'\r\nimport { post } from '@/libs/axios-cfg'\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      selections: [],\r\n      removeModal: false,\r\n      setting: {\r\n        loading: true,\r\n        showBorder: true\r\n      },\r\n      columns: [\r\n        {\r\n          type: 'selection',\r\n          width: 60,\r\n          align: 'center'\r\n        },\r\n        { title: '用户ID', key: 'uid' },\r\n        { title: '用户名', key: 'username' },\r\n        { title: '动作名称', key: 'actionName' },\r\n        {\r\n          title: 'IP', key: 'ip', render: (h, params) => {\r\n            let ip = params.row.ip\r\n            let ipSplit = ip.split('.')\r\n            if (ipSplit.length == 4) {\r\n              return h('span', ipSplit[0] + '.' + '***' + '.' + ipSplit[2] + '.' + ipSplit[3])\r\n            }\r\n            return h('span', ip)\r\n          }\r\n        },\r\n        {\r\n          title: '请求类型', key: 'ajax', render: (h, params) => {\r\n            return h('span', params.row.ajax == 0 ? '普通请求' : 'AJAX请求')\r\n          }\r\n        },\r\n        { title: '请求地址', key: 'uri' },\r\n        { title: '请求参数', key: 'params' },\r\n        { title: '请求方法', key: 'httpMethod' },\r\n        { title: '类.方法', key: 'classMethod' },\r\n        {\r\n          title: '创建日期',\r\n          key: 'createDate',\r\n          render: (h, params) => {\r\n            return h('span', dayjs(params.row.createDate).format('YYYY年MM月DD日 HH:mm:ss'))\r\n          },\r\n          sortable: true\r\n        },\r\n        {\r\n          title: '操作',\r\n          key: 'action',\r\n          align: 'center',\r\n          render: (h, params) => {\r\n            return h('div', [\r\n              h('Button', {\r\n                props: { type: 'error', size: 'small' },\r\n                style: { marginRight: '5px' },\r\n                on: {\r\n                  click: () => {\r\n                    this.removeList(params.row.id)\r\n                  }\r\n                }\r\n              }, '删除')\r\n            ])\r\n          }\r\n        }\r\n      ],\r\n      data: {},\r\n      dataFilter: {\r\n        page: 1,\r\n        pageSize: 10\r\n      },\r\n      removeObject: null\r\n    }\r\n  },\r\n  created () {\r\n    this.getData()\r\n  },\r\n  methods: {\r\n    /**\r\n     * @description 批量选择回调\r\n     */\r\n    selectionChange (list) {\r\n      this.selections = list\r\n    },\r\n    /**\r\n     * @description 分页更换事件回调\r\n     */\r\n    pageChange (p) {\r\n      this.dataFilter.page = p\r\n      this.getData()\r\n    },\r\n    /**\r\n     * @description 分页每页显示数量改变事件回调\r\n     */\r\n    pageSizeChange (p) {\r\n      this.dataFilter.pageSize = p\r\n      this.getData()\r\n    },\r\n    /**\r\n     * @description 获取用户列表\r\n     */\r\n    async getData () {\r\n      this.setting.loading = true\r\n      try {\r\n        let res = await post('/system/log/list', {\r\n          page: this.dataFilter.page,\r\n          pageSize: this.dataFilter.pageSize\r\n        })\r\n        this.data = res.data\r\n      } catch (error) {\r\n        this.$throw(error)\r\n      }\r\n      this.setting.loading = false\r\n    },\r\n    /**\r\n     * @description 批量删除\r\n     */\r\n    async removeList (single = false) {\r\n      this.setting.loading = true\r\n      this.$Message.loading({\r\n        content: '日志删除中...',\r\n        duration: 0\r\n      })\r\n      let objs = []\r\n      if (single) {\r\n        objs.push(single)\r\n      } else {\r\n        this.selections.forEach(el => {\r\n          objs.push(el.id)\r\n        })\r\n      }\r\n      try {\r\n        let res = await post('/system/log/remove', objs)\r\n        this.getData()\r\n        this.selections = []\r\n        this.$Message.destroy()\r\n        this.$Message.success({\r\n          content: '日志删除成功',\r\n          duration: 1.5\r\n        })\r\n      } catch (error) {\r\n        this.$throw(error)\r\n      }\r\n      this.setting.loading = false\r\n    },\r\n    /**\r\n     * @description 导出表格CSV\r\n     */\r\n    exportData (type) {\r\n      if (type === 1) {\r\n        this.$refs.table.exportCsv({\r\n          filename: '日志数据-' + new Date().getTime(),\r\n          columns: this.columns.filter((col, index) => index > 0 && index < this.columns.length - 1),\r\n          data: this.data.records\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}