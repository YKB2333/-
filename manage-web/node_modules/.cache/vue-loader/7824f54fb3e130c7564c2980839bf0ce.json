{"remainingRequest":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\system\\role\\components\\update.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\system\\role\\components\\update.vue","mtime":1562898218000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { post } from '@/libs/axios-cfg'\r\nexport default {\r\n    data(){\r\n        return {\r\n            formItem: {\r\n                    name:'',\r\n                    permissions: []\r\n            },\r\n            showModal:true,\r\n            loading: false,\r\n            ruleValidate:{\r\n                name:[\r\n                    { required: true, message: '角色名称不能为空'}\r\n                ]\r\n            }\r\n        }\r\n    },\r\n    props:{\r\n        updateObject:{\r\n            type:Object,\r\n            default:null\r\n        },\r\n        allResource:{\r\n            type:Array\r\n        }\r\n    },\r\n    created(){\r\n        if(this.updateObject!=null){\r\n            this.formItem.name = this.updateObject.name;\r\n        }\r\n        this.getAllResource()\r\n    },\r\n    methods:{\r\n      cancel(up=false){\r\n          this.$emit('cancel',up);\r\n      },\r\n      ok(){\r\n        let useList = this.$refs.tree.getCheckedNodes();\r\n        this.$refs.updateRole.validate((valid) => {\r\n            if (valid) {\r\n                if(useList.length<1){\r\n                    this.$Notice.destroy();\r\n                    this.$Notice.warning({\r\n                        title: '请至少选择一个权限资源',\r\n                        duration: 2\r\n                    });\r\n                }else{\r\n                    let postObj = {\r\n                        name:this.formItem.name,\r\n                        resources:useList\r\n                    }\r\n                    this.update(postObj)\r\n                }\r\n            }\r\n        })\r\n      },\r\n      async update(data){\r\n        this.loading = true;\r\n        try {\r\n            let res = await post('/system/role/update/{id}',data,{\r\n                id:this.updateObject.id\r\n            })\r\n            this.$Message.success(\"角色 \"+data.name+\" 更新成功\");\r\n            this.cancel(true);\r\n        } catch (error) {\r\n            this.$throw(error)\r\n        }\r\n        this.loading = false;\r\n      },\r\n      async getAllResource(){\r\n        let res = JSON.parse(JSON.stringify(this.allResource));\r\n        this.dealPostData(res)\r\n        this.formItem.permissions = res;\r\n      },\r\n      permissionSync(data,ro){\r\n        if(data!=null && data.length>0){\r\n            data.forEach(r => {\r\n                if(r.id==ro.id){\r\n                    ro.checked = true;\r\n                }\r\n                if(r.children!=null && r.children.length>0){\r\n                    permissionSync(data,ro)\r\n                }\r\n            })\r\n        }\r\n      },\r\n      dealPostData(data){\r\n          data.forEach(element => {\r\n              element.title = element.name;\r\n              this.permissionSync(this.updateObject.resources,element)\r\n              if(element.children!=null){\r\n                  this.dealPostData(element.children)\r\n              }\r\n          });\r\n      }\r\n  }\r\n}\r\n",{"version":3,"sources":["update.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"update.vue","sourceRoot":"src/view/system/role/components","sourcesContent":["<template>\r\n  <div>\r\n      <!-- 更新角色  -->\r\n        <Modal v-model=\"showModal\" title=\"更新角色\" :loading=\"loading\" :mask-closable=\"false\" :width=\"800\" :closable=\"false\">\r\n            <Form ref=\"updateRole\" :model=\"formItem\" :label-width=\"90\" :rules=\"ruleValidate\">\r\n                <FormItem label=\"角色名称：\" prop=\"name\">\r\n                    <Input v-model=\"formItem.name\" placeholder=\"角色名称\"></Input>\r\n                </FormItem>\r\n            </Form>\r\n            <Form  :label-width=\"70\">\r\n                <FormItem label=\"权限集：\" prop=\"permissions\">\r\n                    <Tree ref=\"tree\" :data=\"formItem.permissions\" show-checkbox></Tree>\r\n                </FormItem>\r\n            </Form>\r\n            <div slot=\"footer\">\r\n                <Button type=\"default\" :disabled=\"loading\" @click=\"cancel(false)\">取消</Button>\r\n                <Button type=\"primary\" :loading=\"loading\" @click=\"ok\">确定</Button>\r\n            </div>\r\n        </Modal>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { post } from '@/libs/axios-cfg'\r\nexport default {\r\n    data(){\r\n        return {\r\n            formItem: {\r\n                    name:'',\r\n                    permissions: []\r\n            },\r\n            showModal:true,\r\n            loading: false,\r\n            ruleValidate:{\r\n                name:[\r\n                    { required: true, message: '角色名称不能为空'}\r\n                ]\r\n            }\r\n        }\r\n    },\r\n    props:{\r\n        updateObject:{\r\n            type:Object,\r\n            default:null\r\n        },\r\n        allResource:{\r\n            type:Array\r\n        }\r\n    },\r\n    created(){\r\n        if(this.updateObject!=null){\r\n            this.formItem.name = this.updateObject.name;\r\n        }\r\n        this.getAllResource()\r\n    },\r\n    methods:{\r\n      cancel(up=false){\r\n          this.$emit('cancel',up);\r\n      },\r\n      ok(){\r\n        let useList = this.$refs.tree.getCheckedNodes();\r\n        this.$refs.updateRole.validate((valid) => {\r\n            if (valid) {\r\n                if(useList.length<1){\r\n                    this.$Notice.destroy();\r\n                    this.$Notice.warning({\r\n                        title: '请至少选择一个权限资源',\r\n                        duration: 2\r\n                    });\r\n                }else{\r\n                    let postObj = {\r\n                        name:this.formItem.name,\r\n                        resources:useList\r\n                    }\r\n                    this.update(postObj)\r\n                }\r\n            }\r\n        })\r\n      },\r\n      async update(data){\r\n        this.loading = true;\r\n        try {\r\n            let res = await post('/system/role/update/{id}',data,{\r\n                id:this.updateObject.id\r\n            })\r\n            this.$Message.success(\"角色 \"+data.name+\" 更新成功\");\r\n            this.cancel(true);\r\n        } catch (error) {\r\n            this.$throw(error)\r\n        }\r\n        this.loading = false;\r\n      },\r\n      async getAllResource(){\r\n        let res = JSON.parse(JSON.stringify(this.allResource));\r\n        this.dealPostData(res)\r\n        this.formItem.permissions = res;\r\n      },\r\n      permissionSync(data,ro){\r\n        if(data!=null && data.length>0){\r\n            data.forEach(r => {\r\n                if(r.id==ro.id){\r\n                    ro.checked = true;\r\n                }\r\n                if(r.children!=null && r.children.length>0){\r\n                    permissionSync(data,ro)\r\n                }\r\n            })\r\n        }\r\n      },\r\n      dealPostData(data){\r\n          data.forEach(element => {\r\n              element.title = element.name;\r\n              this.permissionSync(this.updateObject.resources,element)\r\n              if(element.children!=null){\r\n                  this.dealPostData(element.children)\r\n              }\r\n          });\r\n      }\r\n  }\r\n}\r\n</script>\r\n\r\n"]}]}