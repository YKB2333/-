{"remainingRequest":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\system\\role\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\system\\role\\index.vue","mtime":1562898218000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport AddRole from './components/add.vue'\nimport UpdateRole from './components/update.vue'\nimport { post } from '@/libs/axios-cfg'\nexport default {\n    data () {\n        return {\n            addRoleModal:false,\n            updateRoleModal:false,\n            updateObject:null,\n            removeModal:false,\n            setting:{\n                loading:true,\n                showBorder:true\n            },\n            search:{\n                type:'name',\n                value:''\n            },\n            columns: [\n                {title: 'ID', key: 'id',sortable: true},\n                {title: '角色名', key: 'name',sortable: true},\n                {\n                    title: '操作',\n                    key: 'action',\n                    width: 260,\n                    align: 'center',\n                    render: (h, params) => {\n                        return h('div', [\n                            h('Button', {\n                                props: {type: 'success',size: 'small'},\n                                style: {marginRight: '5px'},\n                                on:{\n                                    click:()=>{\n                                        this.showAllResource(params.row)\n                                    }\n                                }\n                            }, '查看权限集'),\n                            h('Button', {\n                                props: {type: 'primary',size: 'small'},\n                                style: {marginRight: '5px'},\n                                on:{\n                                    click:()=>{\n                                        this.openAddOrUpModal(params.row)\n                                    }\n                                }\n                            }, '修改信息'),\n                            h('Button', {\n                                props: {type: 'error',size: 'small'},\n                                on:{\n                                    click:()=>{\n                                        this.removeObject = {\n                                            obj:params.row,\n                                            index:params.index\n                                        }\n                                        this.removeModal = true;\n                                    }\n                                }\n                            }, '删除')\n                        ]);\n                    }\n                }\n            ],\n            data: {},\n            dataFilter:{\n                page:1,\n                pageSize:10\n            },\n            removeObject:null,\n            allResource:null\n        }\n    },\n    components: {\n        AddRole,UpdateRole\n    },\n    created(){\n        this.getData();\n    },\n    methods:{\n        pageChange(p){\n            this.dataFilter.page = p;\n            this.getData();\n        },\n        pageSizeChange(p){\n            this.dataFilter.pageSize = p;\n            this.getData();\n        },\n        async getAllResource(){\n            try {\n                let res = await post('/system/resource/list')\n                this.allResource = res.data;\n            } catch (error) {\n                this.$throw(error)\n            }\n        },\n        async remove(){\n            this.removeModal = false;\n            if(this.removeObject==null){\n                this.$Message.warning(\"删除对象为空，无法继续执行！\");\n                return false;\n            }\n            this.setting.loading = true;\n            try {\n                let res = await post('/system/role/remove/{rid}',null,{\n                    rid: this.removeObject.obj.id\n                })\n               this.$Message.success(\"删除成功\");\n                this.data.records.splice(this.removeObject.index,1);\n            } catch (error) {\n                this.$throw(error)\n            }\n            this.setting.loading = false;\n        },\n        async getData(){\n            this.setting.loading = true;\n            try {\n                let res = await post('/system/role/list',{\n                    page:this.dataFilter.page,\n                    pageSize:this.dataFilter.pageSize\n                })\n                this.data = res.data;\n            } catch (error) {\n                this.$throw(error)\n            }\n            this.setting.loading = false;\n        },\n        async openAddOrUpModal(obj,type = 'update'){\n            if(this.allResource===null){\n               await this.getAllResource();\n            }\n            if(obj===null){\n                this.addRoleModal = true;\n            }else if(type==='update'){\n                this.updateObject = obj;\n                this.updateRoleModal = true;\n            }\n        },\n        onAddRoleModalCancel(up=false){\n            this.addRoleModal = false;\n            if(up) this.getData()\n        },\n        onUpdateRoleModalCancel(up=false){\n            this.updateRoleModal = false;\n            if(up) this.getData()\n        },\n        dealPostData(data, ps, h){\n            if(data!=null){\n                data.forEach(element => {\n                    let r = h('Tag',{\n                        props:{\n                            color:'green',\n                            type:'dot'\n                        }\n                    },element.name);\n                    ps.push(r);\n                    if(element.children!=null){\n                        this.dealPostData(element.children, ps, h)\n                    }\n                });\n            }\n\n        },\n        showAllResource(row){\n            let resources = row.resources;\n            if(resources!=null && typeof(resources)==\"object\" && resources.length > 0){\n                this.$Modal.info({\n                    title: row.name+' - 权限集',\n                    width:'40%',\n                    render: (h)=>{\n                        let ps = [];\n                        resources.forEach(element => {\n                            let r = h('Tag',{\n                                props:{\n                                    color:element.color=='' ? 'green' : element.color,\n                                    type:'dot',\n                                }\n                            },element.name);\n                            ps.push(r);\n                            this.dealPostData(element.children,ps, h)\n                        });\n                        return h('div',{\n                            style:{padding:'20px 0 10px 0'}\n                        },ps);\n                    }\n                });\n            }else{\n                this.$Notice.destroy()\n                this.$Notice.info({\n                    title:\"该角色暂无权限信息\",\n                    duration:3\n                })\n            }\n        },\n        exportData(type){\n            if (type === 1) {\n                this.$refs.table.exportCsv({\n                    filename: '权限数据-'+new Date().getTime(),\n                    columns: this.columns.filter((col, index) => index != 2),\n                    data: this.data.records\n                });\n            }\n        }\n    }\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/view/system/role","sourcesContent":["<template>\r\n    <div>\r\n        <Card>\r\n            <p slot=\"title\" class=\"card-title\">\r\n                <Icon type=\"home\"></Icon>\r\n                <span>角色管理</span>\r\n            </p>\r\n            <div>\r\n                <template>\r\n                    <Row>\r\n                        <Col span=\"15\">\r\n                            <Button type=\"info\" @click=\"openAddOrUpModal(null)\"><Icon type=\"md-add\"></Icon>&nbsp;添加角色</Button>\r\n                            <Button :disabled=\"setting.loading\" type=\"success\" @click=\"getData\"><Icon type=\"md-refresh\"></Icon>&nbsp;刷新数据</Button>\r\n                            <Button type=\"primary\" @click=\"exportData(1)\"><Icon type=\"ios-download-outline\"></Icon>&nbsp;导出表格</Button>\r\n                        </Col>\r\n                        <Col span=\"9\">\r\n                            <Input v-model=\"search.value\" placeholder=\"请输入您想要搜索的内容...\" class=\"margin-bottom-10\">\r\n                                <Button slot=\"append\" icon=\"ios-search\"></Button>\r\n                            </Input>\r\n                        </Col>\r\n                    </Row>\r\n                    <Table  ref=\"table\"  class=\"margin-bottom-10\" :columns=\"columns\"\r\n                        :loading=\"setting.loading\"  :border=\"setting.showBorder\" :data=\"data.records\"></Table>\r\n                     <Page :total=\"data.total\" class=\"tr\" @on-change=\"pageChange\":current.sync=\"data.current\" :page-size=\"data.size\"\r\n                      @on-page-size-change=\"pageSizeChange\" show-elevator show-sizer></Page>\r\n                </template>\r\n            </div>\r\n        </Card>\r\n        <AddRole v-if=\"addRoleModal\" :all-resource=\"allResource\" @cancel=\"onAddRoleModalCancel\"/>\r\n        <UpdateRole v-if=\"updateRoleModal\" :all-resource=\"allResource\" :update-object=\"updateObject\" @cancel=\"onUpdateRoleModalCancel\"/>\r\n        <Modal v-model=\"removeModal\" width=\"360\">\r\n            <p slot=\"header\" style=\"color:#f60;text-align:center\">\r\n                <Icon type=\"information-circled\"></Icon>\r\n                <span>提示</span>\r\n            </p>\r\n            <div style=\"text-align:center\">\r\n                <p>此操作为不可逆操作，是否确认删除？</p>\r\n            </div>\r\n            <div slot=\"footer\">\r\n                <Button type=\"error\" size=\"large\" long :loading=\"setting.loading\" @click=\"remove\">确认删除</Button>\r\n            </div>\r\n        </Modal>\r\n    </div>\r\n</template>\r\n<script>\r\n    import AddRole from './components/add.vue'\r\n    import UpdateRole from './components/update.vue'\r\n    import { post } from '@/libs/axios-cfg'\r\n    export default {\r\n        data () {\r\n            return {\r\n                addRoleModal:false,\r\n                updateRoleModal:false,\r\n                updateObject:null,\r\n                removeModal:false,\r\n                setting:{\r\n                    loading:true,\r\n                    showBorder:true\r\n                },\r\n                search:{\r\n                    type:'name',\r\n                    value:''\r\n                },\r\n                columns: [\r\n                    {title: 'ID', key: 'id',sortable: true},\r\n                    {title: '角色名', key: 'name',sortable: true},\r\n                    {\r\n                        title: '操作',\r\n                        key: 'action',\r\n                        width: 260,\r\n                        align: 'center',\r\n                        render: (h, params) => {\r\n                            return h('div', [\r\n                                h('Button', {\r\n                                    props: {type: 'success',size: 'small'},\r\n                                    style: {marginRight: '5px'},\r\n                                    on:{\r\n                                        click:()=>{\r\n                                            this.showAllResource(params.row)\r\n                                        }\r\n                                    }\r\n                                }, '查看权限集'),\r\n                                h('Button', {\r\n                                    props: {type: 'primary',size: 'small'},\r\n                                    style: {marginRight: '5px'},\r\n                                    on:{\r\n                                        click:()=>{\r\n                                            this.openAddOrUpModal(params.row)\r\n                                        }\r\n                                    }\r\n                                }, '修改信息'),\r\n                                h('Button', {\r\n                                    props: {type: 'error',size: 'small'},\r\n                                    on:{\r\n                                        click:()=>{\r\n                                            this.removeObject = {\r\n                                                obj:params.row,\r\n                                                index:params.index\r\n                                            }\r\n                                            this.removeModal = true;\r\n                                        }\r\n                                    }\r\n                                }, '删除')\r\n                            ]);\r\n                        }\r\n                    }\r\n                ],\r\n                data: {},\r\n                dataFilter:{\r\n                    page:1,\r\n                    pageSize:10\r\n                },\r\n                removeObject:null,\r\n                allResource:null\r\n            }\r\n        },\r\n        components: {\r\n            AddRole,UpdateRole\r\n        },\r\n        created(){\r\n            this.getData();\r\n        },\r\n        methods:{\r\n            pageChange(p){\r\n                this.dataFilter.page = p;\r\n                this.getData();\r\n            },\r\n            pageSizeChange(p){\r\n                this.dataFilter.pageSize = p;\r\n                this.getData();\r\n            },\r\n            async getAllResource(){\r\n                try {\r\n                    let res = await post('/system/resource/list')\r\n                    this.allResource = res.data;\r\n                } catch (error) {\r\n                    this.$throw(error)\r\n                }\r\n            },\r\n            async remove(){\r\n                this.removeModal = false;\r\n                if(this.removeObject==null){\r\n                    this.$Message.warning(\"删除对象为空，无法继续执行！\");\r\n                    return false;\r\n                }\r\n                this.setting.loading = true;\r\n                try {\r\n                    let res = await post('/system/role/remove/{rid}',null,{\r\n                        rid: this.removeObject.obj.id\r\n                    })\r\n                   this.$Message.success(\"删除成功\");\r\n                    this.data.records.splice(this.removeObject.index,1);\r\n                } catch (error) {\r\n                    this.$throw(error)\r\n                }\r\n                this.setting.loading = false;\r\n            },\r\n            async getData(){\r\n                this.setting.loading = true;\r\n                try {\r\n                    let res = await post('/system/role/list',{\r\n                        page:this.dataFilter.page,\r\n                        pageSize:this.dataFilter.pageSize\r\n                    })\r\n                    this.data = res.data;\r\n                } catch (error) {\r\n                    this.$throw(error)\r\n                }\r\n                this.setting.loading = false;\r\n            },\r\n            async openAddOrUpModal(obj,type = 'update'){\r\n                if(this.allResource===null){\r\n                   await this.getAllResource();\r\n                }\r\n                if(obj===null){\r\n                    this.addRoleModal = true;\r\n                }else if(type==='update'){\r\n                    this.updateObject = obj;\r\n                    this.updateRoleModal = true;\r\n                }\r\n            },\r\n            onAddRoleModalCancel(up=false){\r\n                this.addRoleModal = false;\r\n                if(up) this.getData()\r\n            },\r\n            onUpdateRoleModalCancel(up=false){\r\n                this.updateRoleModal = false;\r\n                if(up) this.getData()\r\n            },\r\n            dealPostData(data, ps, h){\r\n                if(data!=null){\r\n                    data.forEach(element => {\r\n                        let r = h('Tag',{\r\n                            props:{\r\n                                color:'green',\r\n                                type:'dot'\r\n                            }\r\n                        },element.name);\r\n                        ps.push(r);\r\n                        if(element.children!=null){\r\n                            this.dealPostData(element.children, ps, h)\r\n                        }\r\n                    });\r\n                }\r\n\r\n            },\r\n            showAllResource(row){\r\n                let resources = row.resources;\r\n                if(resources!=null && typeof(resources)==\"object\" && resources.length > 0){\r\n                    this.$Modal.info({\r\n                        title: row.name+' - 权限集',\r\n                        width:'40%',\r\n                        render: (h)=>{\r\n                            let ps = [];\r\n                            resources.forEach(element => {\r\n                                let r = h('Tag',{\r\n                                    props:{\r\n                                        color:element.color=='' ? 'green' : element.color,\r\n                                        type:'dot',\r\n                                    }\r\n                                },element.name);\r\n                                ps.push(r);\r\n                                this.dealPostData(element.children,ps, h)\r\n                            });\r\n                            return h('div',{\r\n                                style:{padding:'20px 0 10px 0'}\r\n                            },ps);\r\n                        }\r\n                    });\r\n                }else{\r\n                    this.$Notice.destroy()\r\n                    this.$Notice.info({\r\n                        title:\"该角色暂无权限信息\",\r\n                        duration:3\r\n                    })\r\n                }\r\n            },\r\n            exportData(type){\r\n                if (type === 1) {\r\n                    this.$refs.table.exportCsv({\r\n                        filename: '权限数据-'+new Date().getTime(),\r\n                        columns: this.columns.filter((col, index) => index != 2),\r\n                        data: this.data.records\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n</script>\r\n"]}]}