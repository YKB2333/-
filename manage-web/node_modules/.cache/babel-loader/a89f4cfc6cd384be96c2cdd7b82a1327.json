{"remainingRequest":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\system\\log\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\system\\log\\index.vue","mtime":1562898218000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport dayjs from 'dayjs';\nimport { post } from '@/libs/axios-cfg';\nexport default {\n  data() {\n    return {\n      selections: [],\n      removeModal: false,\n      setting: {\n        loading: true,\n        showBorder: true\n      },\n      columns: [{\n        type: 'selection',\n        width: 60,\n        align: 'center'\n      }, {\n        title: '用户ID',\n        key: 'uid'\n      }, {\n        title: '用户名',\n        key: 'username'\n      }, {\n        title: '动作名称',\n        key: 'actionName'\n      }, {\n        title: 'IP',\n        key: 'ip',\n        render: (h, params) => {\n          let ip = params.row.ip;\n          let ipSplit = ip.split('.');\n\n          if (ipSplit.length == 4) {\n            return h('span', ipSplit[0] + '.' + '***' + '.' + ipSplit[2] + '.' + ipSplit[3]);\n          }\n\n          return h('span', ip);\n        }\n      }, {\n        title: '请求类型',\n        key: 'ajax',\n        render: (h, params) => {\n          return h('span', params.row.ajax == 0 ? '普通请求' : 'AJAX请求');\n        }\n      }, {\n        title: '请求地址',\n        key: 'uri'\n      }, {\n        title: '请求参数',\n        key: 'params'\n      }, {\n        title: '请求方法',\n        key: 'httpMethod'\n      }, {\n        title: '类.方法',\n        key: 'classMethod'\n      }, {\n        title: '创建日期',\n        key: 'createDate',\n        render: (h, params) => {\n          return h('span', dayjs(params.row.createDate).format('YYYY年MM月DD日 HH:mm:ss'));\n        },\n        sortable: true\n      }, {\n        title: '操作',\n        key: 'action',\n        align: 'center',\n        render: (h, params) => {\n          return h('div', [h('Button', {\n            props: {\n              type: 'error',\n              size: 'small'\n            },\n            style: {\n              marginRight: '5px'\n            },\n            on: {\n              click: () => {\n                this.removeList(params.row.id);\n              }\n            }\n          }, '删除')]);\n        }\n      }],\n      data: {},\n      dataFilter: {\n        page: 1,\n        pageSize: 10\n      },\n      removeObject: null\n    };\n  },\n\n  created() {\n    this.getData();\n  },\n\n  methods: {\n    /**\r\n     * @description 批量选择回调\r\n     */\n    selectionChange(list) {\n      this.selections = list;\n    },\n\n    /**\r\n     * @description 分页更换事件回调\r\n     */\n    pageChange(p) {\n      this.dataFilter.page = p;\n      this.getData();\n    },\n\n    /**\r\n     * @description 分页每页显示数量改变事件回调\r\n     */\n    pageSizeChange(p) {\n      this.dataFilter.pageSize = p;\n      this.getData();\n    },\n\n    /**\r\n     * @description 获取用户列表\r\n     */\n    async getData() {\n      this.setting.loading = true;\n\n      try {\n        let res = await post('/system/log/list', {\n          page: this.dataFilter.page,\n          pageSize: this.dataFilter.pageSize\n        });\n        this.data = res.data;\n      } catch (error) {\n        this.$throw(error);\n      }\n\n      this.setting.loading = false;\n    },\n\n    /**\r\n     * @description 批量删除\r\n     */\n    async removeList(single = false) {\n      this.setting.loading = true;\n      this.$Message.loading({\n        content: '日志删除中...',\n        duration: 0\n      });\n      let objs = [];\n\n      if (single) {\n        objs.push(single);\n      } else {\n        this.selections.forEach(el => {\n          objs.push(el.id);\n        });\n      }\n\n      try {\n        let res = await post('/system/log/remove', objs);\n        this.getData();\n        this.selections = [];\n        this.$Message.destroy();\n        this.$Message.success({\n          content: '日志删除成功',\n          duration: 1.5\n        });\n      } catch (error) {\n        this.$throw(error);\n      }\n\n      this.setting.loading = false;\n    },\n\n    /**\r\n     * @description 导出表格CSV\r\n     */\n    exportData(type) {\n      if (type === 1) {\n        this.$refs.table.exportCsv({\n          filename: '日志数据-' + new Date().getTime(),\n          columns: this.columns.filter((col, index) => index > 0 && index < this.columns.length - 1),\n          data: this.data.records\n        });\n      }\n    }\n\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div>\r\n    <Card>\r\n      <p slot=\"title\" class=\"card-title\">\r\n        <Icon type=\"home\"></Icon>\r\n        <span>日志管理</span>\r\n      </p>\r\n      <div>\r\n        <template>\r\n          <Row>\r\n            <Col span=\"15\" class=\"margin-bottom-10\">\r\n              <Button :disabled=\"setting.loading\" type=\"success\" @click=\"getData\">\r\n                <Icon type=\"md-refresh\"></Icon>&nbsp;刷新数据\r\n              </Button>\r\n              <Button :disabled=\"selections.length==0 || setting.loading\" type=\"error\" @click=\"removeList(false)\">\r\n                <Icon type=\"trash-a\"></Icon>&nbsp;批量删除所选\r\n              </Button>\r\n              <Button type=\"primary\" @click=\"exportData(1)\">\r\n                <Icon type=\"ios-download-outline\"></Icon>&nbsp;导出表格\r\n              </Button>\r\n            </Col>\r\n          </Row>\r\n          <Table ref=\"table\" class=\"margin-bottom-10\" @on-selection-change=\"selectionChange\"\r\n                 :columns=\"columns\" :loading=\"setting.loading\" :border=\"setting.showBorder\"\r\n                 :data=\"data.records\"></Table>\r\n          <Page :total=\"data.total\" class=\"tr\" @on-change=\"pageChange\" :current.sync=\"data.current\"\r\n                :page-size=\"data.size\"\r\n                @on-page-size-change=\"pageSizeChange\" show-elevator show-sizer></Page>\r\n        </template>\r\n      </div>\r\n    </Card>\r\n    <Modal v-model=\"removeModal\" width=\"360\">\r\n      <p slot=\"header\" style=\"color:#f60;text-align:center\">\r\n        <Icon type=\"information-circled\"></Icon>\r\n        <span>提示</span>\r\n      </p>\r\n      <div style=\"text-align:center\">\r\n        <p>此操作为不可逆操作，是否确认删除？</p>\r\n      </div>\r\n      <div slot=\"footer\">\r\n        <Button type=\"error\" size=\"large\" long :loading=\"setting.loading\">确认删除</Button>\r\n      </div>\r\n    </Modal>\r\n  </div>\r\n</template>\r\n<script>\r\nimport dayjs from 'dayjs'\r\nimport { post } from '@/libs/axios-cfg'\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      selections: [],\r\n      removeModal: false,\r\n      setting: {\r\n        loading: true,\r\n        showBorder: true\r\n      },\r\n      columns: [\r\n        {\r\n          type: 'selection',\r\n          width: 60,\r\n          align: 'center'\r\n        },\r\n        { title: '用户ID', key: 'uid' },\r\n        { title: '用户名', key: 'username' },\r\n        { title: '动作名称', key: 'actionName' },\r\n        {\r\n          title: 'IP', key: 'ip', render: (h, params) => {\r\n            let ip = params.row.ip\r\n            let ipSplit = ip.split('.')\r\n            if (ipSplit.length == 4) {\r\n              return h('span', ipSplit[0] + '.' + '***' + '.' + ipSplit[2] + '.' + ipSplit[3])\r\n            }\r\n            return h('span', ip)\r\n          }\r\n        },\r\n        {\r\n          title: '请求类型', key: 'ajax', render: (h, params) => {\r\n            return h('span', params.row.ajax == 0 ? '普通请求' : 'AJAX请求')\r\n          }\r\n        },\r\n        { title: '请求地址', key: 'uri' },\r\n        { title: '请求参数', key: 'params' },\r\n        { title: '请求方法', key: 'httpMethod' },\r\n        { title: '类.方法', key: 'classMethod' },\r\n        {\r\n          title: '创建日期',\r\n          key: 'createDate',\r\n          render: (h, params) => {\r\n            return h('span', dayjs(params.row.createDate).format('YYYY年MM月DD日 HH:mm:ss'))\r\n          },\r\n          sortable: true\r\n        },\r\n        {\r\n          title: '操作',\r\n          key: 'action',\r\n          align: 'center',\r\n          render: (h, params) => {\r\n            return h('div', [\r\n              h('Button', {\r\n                props: { type: 'error', size: 'small' },\r\n                style: { marginRight: '5px' },\r\n                on: {\r\n                  click: () => {\r\n                    this.removeList(params.row.id)\r\n                  }\r\n                }\r\n              }, '删除')\r\n            ])\r\n          }\r\n        }\r\n      ],\r\n      data: {},\r\n      dataFilter: {\r\n        page: 1,\r\n        pageSize: 10\r\n      },\r\n      removeObject: null\r\n    }\r\n  },\r\n  created () {\r\n    this.getData()\r\n  },\r\n  methods: {\r\n    /**\r\n     * @description 批量选择回调\r\n     */\r\n    selectionChange (list) {\r\n      this.selections = list\r\n    },\r\n    /**\r\n     * @description 分页更换事件回调\r\n     */\r\n    pageChange (p) {\r\n      this.dataFilter.page = p\r\n      this.getData()\r\n    },\r\n    /**\r\n     * @description 分页每页显示数量改变事件回调\r\n     */\r\n    pageSizeChange (p) {\r\n      this.dataFilter.pageSize = p\r\n      this.getData()\r\n    },\r\n    /**\r\n     * @description 获取用户列表\r\n     */\r\n    async getData () {\r\n      this.setting.loading = true\r\n      try {\r\n        let res = await post('/system/log/list', {\r\n          page: this.dataFilter.page,\r\n          pageSize: this.dataFilter.pageSize\r\n        })\r\n        this.data = res.data\r\n      } catch (error) {\r\n        this.$throw(error)\r\n      }\r\n      this.setting.loading = false\r\n    },\r\n    /**\r\n     * @description 批量删除\r\n     */\r\n    async removeList (single = false) {\r\n      this.setting.loading = true\r\n      this.$Message.loading({\r\n        content: '日志删除中...',\r\n        duration: 0\r\n      })\r\n      let objs = []\r\n      if (single) {\r\n        objs.push(single)\r\n      } else {\r\n        this.selections.forEach(el => {\r\n          objs.push(el.id)\r\n        })\r\n      }\r\n      try {\r\n        let res = await post('/system/log/remove', objs)\r\n        this.getData()\r\n        this.selections = []\r\n        this.$Message.destroy()\r\n        this.$Message.success({\r\n          content: '日志删除成功',\r\n          duration: 1.5\r\n        })\r\n      } catch (error) {\r\n        this.$throw(error)\r\n      }\r\n      this.setting.loading = false\r\n    },\r\n    /**\r\n     * @description 导出表格CSV\r\n     */\r\n    exportData (type) {\r\n      if (type === 1) {\r\n        this.$refs.table.exportCsv({\r\n          filename: '日志数据-' + new Date().getTime(),\r\n          columns: this.columns.filter((col, index) => index > 0 && index < this.columns.length - 1),\r\n          data: this.data.records\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n"],"sourceRoot":"src/view/system/log"}]}