{"remainingRequest":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\system\\role\\components\\update.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\src\\view\\system\\role\\components\\update.vue","mtime":1562898218000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\YKB\\Desktop\\github\\manage-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { post } from '@/libs/axios-cfg';\nexport default {\n  data() {\n    return {\n      formItem: {\n        name: '',\n        permissions: []\n      },\n      showModal: true,\n      loading: false,\n      ruleValidate: {\n        name: [{\n          required: true,\n          message: '角色名称不能为空'\n        }]\n      }\n    };\n  },\n\n  props: {\n    updateObject: {\n      type: Object,\n      default: null\n    },\n    allResource: {\n      type: Array\n    }\n  },\n\n  created() {\n    if (this.updateObject != null) {\n      this.formItem.name = this.updateObject.name;\n    }\n\n    this.getAllResource();\n  },\n\n  methods: {\n    cancel(up = false) {\n      this.$emit('cancel', up);\n    },\n\n    ok() {\n      let useList = this.$refs.tree.getCheckedNodes();\n      this.$refs.updateRole.validate(valid => {\n        if (valid) {\n          if (useList.length < 1) {\n            this.$Notice.destroy();\n            this.$Notice.warning({\n              title: '请至少选择一个权限资源',\n              duration: 2\n            });\n          } else {\n            let postObj = {\n              name: this.formItem.name,\n              resources: useList\n            };\n            this.update(postObj);\n          }\n        }\n      });\n    },\n\n    async update(data) {\n      this.loading = true;\n\n      try {\n        let res = await post('/system/role/update/{id}', data, {\n          id: this.updateObject.id\n        });\n        this.$Message.success(\"角色 \" + data.name + \" 更新成功\");\n        this.cancel(true);\n      } catch (error) {\n        this.$throw(error);\n      }\n\n      this.loading = false;\n    },\n\n    async getAllResource() {\n      let res = JSON.parse(JSON.stringify(this.allResource));\n      this.dealPostData(res);\n      this.formItem.permissions = res;\n    },\n\n    permissionSync(data, ro) {\n      if (data != null && data.length > 0) {\n        data.forEach(r => {\n          if (r.id == ro.id) {\n            ro.checked = true;\n          }\n\n          if (r.children != null && r.children.length > 0) {\n            permissionSync(data, ro);\n          }\n        });\n      }\n    },\n\n    dealPostData(data) {\n      data.forEach(element => {\n        element.title = element.name;\n        this.permissionSync(this.updateObject.resources, element);\n\n        if (element.children != null) {\n          this.dealPostData(element.children);\n        }\n      });\n    }\n\n  }\n};",{"version":3,"sources":["update.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div>\r\n      <!-- 更新角色  -->\r\n        <Modal v-model=\"showModal\" title=\"更新角色\" :loading=\"loading\" :mask-closable=\"false\" :width=\"800\" :closable=\"false\">\r\n            <Form ref=\"updateRole\" :model=\"formItem\" :label-width=\"90\" :rules=\"ruleValidate\">\r\n                <FormItem label=\"角色名称：\" prop=\"name\">\r\n                    <Input v-model=\"formItem.name\" placeholder=\"角色名称\"></Input>\r\n                </FormItem>\r\n            </Form>\r\n            <Form  :label-width=\"70\">\r\n                <FormItem label=\"权限集：\" prop=\"permissions\">\r\n                    <Tree ref=\"tree\" :data=\"formItem.permissions\" show-checkbox></Tree>\r\n                </FormItem>\r\n            </Form>\r\n            <div slot=\"footer\">\r\n                <Button type=\"default\" :disabled=\"loading\" @click=\"cancel(false)\">取消</Button>\r\n                <Button type=\"primary\" :loading=\"loading\" @click=\"ok\">确定</Button>\r\n            </div>\r\n        </Modal>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { post } from '@/libs/axios-cfg'\r\nexport default {\r\n    data(){\r\n        return {\r\n            formItem: {\r\n                    name:'',\r\n                    permissions: []\r\n            },\r\n            showModal:true,\r\n            loading: false,\r\n            ruleValidate:{\r\n                name:[\r\n                    { required: true, message: '角色名称不能为空'}\r\n                ]\r\n            }\r\n        }\r\n    },\r\n    props:{\r\n        updateObject:{\r\n            type:Object,\r\n            default:null\r\n        },\r\n        allResource:{\r\n            type:Array\r\n        }\r\n    },\r\n    created(){\r\n        if(this.updateObject!=null){\r\n            this.formItem.name = this.updateObject.name;\r\n        }\r\n        this.getAllResource()\r\n    },\r\n    methods:{\r\n      cancel(up=false){\r\n          this.$emit('cancel',up);\r\n      },\r\n      ok(){\r\n        let useList = this.$refs.tree.getCheckedNodes();\r\n        this.$refs.updateRole.validate((valid) => {\r\n            if (valid) {\r\n                if(useList.length<1){\r\n                    this.$Notice.destroy();\r\n                    this.$Notice.warning({\r\n                        title: '请至少选择一个权限资源',\r\n                        duration: 2\r\n                    });\r\n                }else{\r\n                    let postObj = {\r\n                        name:this.formItem.name,\r\n                        resources:useList\r\n                    }\r\n                    this.update(postObj)\r\n                }\r\n            }\r\n        })\r\n      },\r\n      async update(data){\r\n        this.loading = true;\r\n        try {\r\n            let res = await post('/system/role/update/{id}',data,{\r\n                id:this.updateObject.id\r\n            })\r\n            this.$Message.success(\"角色 \"+data.name+\" 更新成功\");\r\n            this.cancel(true);\r\n        } catch (error) {\r\n            this.$throw(error)\r\n        }\r\n        this.loading = false;\r\n      },\r\n      async getAllResource(){\r\n        let res = JSON.parse(JSON.stringify(this.allResource));\r\n        this.dealPostData(res)\r\n        this.formItem.permissions = res;\r\n      },\r\n      permissionSync(data,ro){\r\n        if(data!=null && data.length>0){\r\n            data.forEach(r => {\r\n                if(r.id==ro.id){\r\n                    ro.checked = true;\r\n                }\r\n                if(r.children!=null && r.children.length>0){\r\n                    permissionSync(data,ro)\r\n                }\r\n            })\r\n        }\r\n      },\r\n      dealPostData(data){\r\n          data.forEach(element => {\r\n              element.title = element.name;\r\n              this.permissionSync(this.updateObject.resources,element)\r\n              if(element.children!=null){\r\n                  this.dealPostData(element.children)\r\n              }\r\n          });\r\n      }\r\n  }\r\n}\r\n</script>\r\n\r\n"],"sourceRoot":"src/view/system/role/components"}]}